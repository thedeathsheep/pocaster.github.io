---
layout: post
title: 一种咨询类Agent应用的设计
thumbnail-img: /assets/img/0028963732_0.jpg
share-img: /assets/img/0028963732_0.jpg
tags: [Novel, Public]
author: pocaster
---

基于Mermaid的医美咨询AI智能体Demo流程图：

<div class="mermaid">
flowchart TD
    A["用户进入对话"] --> B{"意图识别模块"}
    B -->|"咨询价格"| C["触发价格查询流程"]
    B -->|"术后护理"| D["触发知识库检索"]
    B -->|"人工客服"| E["转接人工并推送用户画像"]

    C --> C1["调用服务价目表数据库"]
    C1 --> C2{"是否指定部位"}
    C2 -->|"是"| C3["返回精确报价"]
    C2 -->|"否"| C4["返回价格区间+案例对比"]

    D --> D1["检索结构化知识库"]
    D1 --> D2["提取术后SOP条款"]
    D2 --> D3["生成带注意事项的回复"]

    E --> E1["同步聊天记录"]
    E1 --> E2["标注用户意向等级"]
</div>

---

### **PRD说明文档（Demo版）**

#### 1. **产品概述**
- **目标**：为医美机构提供24小时自动咨询服务的AI智能体，降低30%人工客服成本
- **核心指标**：意图识别准确率≥85%，平均响应时间<3秒

#### 2. **功能模块说明**

| 模块            | 实现方式                          | 示例                              |
|-----------------|---------------------------------|----------------------------------|
| 意图识别        | NLP分类模型（预置10个医美意图）     | 用户问"隆鼻多少钱" → 触发"价格咨询" |
| 价格查询流程    | 对接机构价目表API + 模糊匹配       | "鼻综合" → 返回"1.5-3.8万"        |
| 知识库检索      | RAG方案（FAISS向量库）           | 问"拆线后注意事项" → 返回PDF条款   |
| 人工转接        | 企业微信API对接 + 用户标签传递     | 推送用户历史行为给客服             |

#### 3. **关键交互逻辑**
- **价格咨询场景**：
  <div class="mermaid">
  flowchart LR
    U["用户问双眼皮价格"] --> S1["匹配到眼部整形分类"]
    S1 --> S2{"是否有促销"}
    S2 -->|"是"| S3["返回原价2万, 本月优惠1.6万"]
    S2 -->|"否"| S4["返回标准价+医生资质说明"]
  </div>

#### 4. **数据需求**
- **必要数据源**：
  1. 机构服务价目表（需含部位/医生/价格三要素）
  2. 术后护理知识库（PDF/Excel结构化数据）
  3. 历史咨询日志（用于bad case分析）

#### 5. **验收标准**
- 成功条件：用户连续3次提问无需人工干预
- 失败处理：自动触发"需要更多信息？转人工"话术

#### 6. **扩展性设计**
- 预留埋点：用户点击"帮助"按钮时记录问题类型
- 可配置项：促销信息通过CMS后台实时更新

---
**RAG**部分：
  <div class="mermaid">
  flowchart LR
    A["用户提问"] --> B["文本向量化"]
    B --> C["在FAISS中搜索"]
    C --> D["返回Top3相关段落"]
    D --> E["LLM生成最终回复"]
  </div>


---

### **用户体验优化**

AI回答的「结构化」与「拟人化」之间的平衡。通过**渐进式拟真策略**提升用户信任感，同时保持系统可控性：

---

### **1. 交互流程优化（Mermaid更新版）**
<div class="mermaid">
%% 拟真客服增强版流程图
flowchart TD
    A["用户提问"] --> B{"AI置信度>80%?"}
    B -->|"是"| C["拟人化三步应答"]
    B -->|"否"| D["有限选项引导"]
  
    C --> C1["共情确认"]
    C1 --> C2["知识库结构化回答"]
    C2 --> C3["开放式结尾"]
  
    D --> D1["提供3个精准选项（例：\n1.价格查询 2.医生资质 3.案例查看）"]
    D1 --> D2["用户选择后触发子流程"]
  
    C3 & D2 --> E{"用户沉默>15秒?"}
    E -->|"是"| F["主动询问是否需要人工"]
    E -->|"否"| G["继续对话"]
</div>

---

### **2. 拟真化设计四要素**

#### **(1) 对话节奏模拟**
<div class="mermaid">
flowchart LR
    U["用户：双眼皮手术恢复期多久？"] 
    --> A1["AI：这个问题很常见呢~（表情符号）"]
    --> A2["大多数客户需要7天拆线（权威引用）"]
    --> A3["不过具体要看体质哦，您近期有手术计划吗？"]
</div>

#### **(2) 置信度兜底机制**
- **低置信度时**：
  ```python
  if confidence < 0.8:
      return "您是想了解：【1】价格 【2】风险 【3】案例对比？"
  ```

#### **(3) 人工介入触发器**

| 触发条件                | 响应策略                          |
|-------------------------|---------------------------------|
| 用户重复提问相同问题     | "可能我没说清楚，帮您转接王顾问？" |
| 包含负面情绪词           | 立即触发人工+发送安抚话术         |
| 涉及医疗敏感词           | "这个问题需要专业医师解答..."     |

#### **(4) 人格化记忆**

<div class="mermaid">
flowchart LR
    A["首次咨询"] -->|提及过敏史| B["标记'敏感体质'"]
    B --> C["后续对话自动加入注意事项"]
</div>
---

### **3. PRD增强条款**

#### **3.1 话术规范**
```markdown
1. **共情模板**：
   - "很多客户都关心这个问题呢~"
   - "完全理解您的顾虑！"

2. **权威背书**：
   - 必须附加引用来源："根据2023年中华医美协会指南..."

3. **不确定性表达**：
   - 禁止使用"100%安全"，改为"临床数据显示90%用户..."
```

#### **3.2 异常处理**
- **医疗紧急情况**：
  <div class="mermaid">
  flowchart LR
      A["用户说'术后大量出血'"] 
      --> B["触发红色警报"]
      --> C["自动发送附近急诊室导航"]
      --> D["同步通知值班医生"]
  </div>

---

### **4. 效果验证指标**

| 指标                  | 基线   | 目标   |
|-----------------------|--------|--------|
| 人工转接率            | 35%    | ≤20%   |
| 对话轮次/会话         | 2.1    | ≥3.5   |
| 用户满意度(NPS)       | 62     | ≥75    |

---

### 执行技术栈

需要在**技术实现**与**客户体验**之间找到最佳平衡点。以下是系统化的方法论和关键技术方案，分为四个核心维度：

---

### **一、效果优化技术栈（Technical Excellence）**
#### 1. **量化评估体系**
<div class="mermaid">
flowchart LR
    A["输入指标"] --> B["转化率/CVR"]
    A --> C["用户停留时长"]
    A --> D["交互深度"]
    B & C & D --> E["建立贝叶斯统计模型"]
    E --> F["动态权重调整"]
    F --> G{"效果看板"}
</div>

- **必测指标**：
  - **增量效果**：A/B测试的Δ%需通过**双样本T检验**（p<0.05）
  - **长期价值**：使用**生存分析**（Survival Analysis）预测用户留存

#### 2. **实时调优技术**
- **推荐系统**：Embedding召回+Transformer排序模型（如：BST模型）
- **参数优化**：多臂老虎机（Multi-armed Bandit）算法动态分配流量
- **异常检测**：Prophet时间序列分析+3σ原则告警

#### 3. **性能兜底方案**
```python
# 伪代码示例：降级策略
if latency > 200ms:
    switch_to('轻量化模型')
if error_rate > 5%:
    activate('缓存上一次成功响应')
```

---

### **二、客户满意度管理（Customer Centricity）**
#### 1. **需求三角验证法**

| 维度       | 验证方式                  | 工具                     |
|------------|--------------------------|--------------------------|
| 业务诉求   | KPI拆解会议              | OKR规划表                |
| 用户真实需求 | 会话日志聚类分析         | NLP主题模型(LDA)         |
| 技术可行性  | 架构评审会               | 系统依赖图(ArchUnit)     |

#### 2. **预期管理工具包**
- **效果承诺书模板**：
  ```
  基线指标：当前CTR=1.2% 
  预期提升：+15%~20%（置信区间95%） 
  达成条件：需客户提供完整用户画像数据
  ```

#### 3. **沟通SOP**
<div class="mermaid">
flowchart TD
    subgraph 启动阶段
        A1[需求分析会议] --> A2[技术方案评审]
        A2 --> A3[风险登记表]
    end

    subgraph 实施阶段
        B1[每周效果简报] --> B2[异常根因分析]
        B2 --> B3[方案调整会议]
    end

    subgraph 收尾阶段
        C1[价值归因报告] --> C2[优化路线图]
        C2 --> C3[经验总结会]
    end

    A3 --> B1
    B3 --> C1

    style 启动阶段 fill:#f9f,stroke:#333,stroke-width:2px
    style 实施阶段 fill:#bbf,stroke:#333,stroke-width:2px
    style 收尾阶段 fill:#bfb,stroke:#333,stroke-width:2px
</div>
---

### **三、落地实施框架（Execution Framework）**
#### 1. **四阶交付法**
1. **冷启动**：用历史数据训练Shadow Model
2. **小步验证**：5%流量灰度测试
3. **持续迭代**：通过FTRL在线学习更新模型
4. **全量交付**：Canary发布+功能开关控制

#### 2. **风险控制矩阵**

| 风险等级 | 技术应对                          | 客户沟通策略                  |
|----------|----------------------------------|-----------------------------|
| P0       | 自动回滚机制                    | 1小时内电话沟通+补偿方案      |
| P1       | 降级服务预案                    | 当日发送修复时间预估          |
| P2       | 监控增强+日志追踪               | 周报中说明改进措施            |

---

### **四、增值服务设计（Value-added Service）**
#### 1. **效果可解释性工具**
- **SHAP值分析**：可视化特征贡献度
  ```python
  import shap
  explainer = shap.TreeExplainer(model)
  shap_values = explainer.shap_values(X_test)
  ```

#### 2. **客户赋能套餐**
- **培训内容**：
  - 如何自主查看实时效果仪表盘
  - 基础指标异常排查指南
  - A/B测试设计原则

#### 3. **长期价值证明**
- **ROI计算模型**：
  ```
  总收益 = (新转化率 - 旧转化率) × 平均客单价 × 流量规模
  成本 = 开发人天 × 费率 + 云计算成本
  ```

---

### **关键话术建议（应对客户质疑）**
1. **当效果未达预期时**：
   > "我们监测到在35-40岁用户群中已有+18%提升，建议针对其他年龄段做定向优化"

2. **当客户要求超出现实时**：
   > "基于当前数据质量，我们推荐先实现70%目标，同时建立数据治理机制为二期做准备"

3. **当技术方案被挑战时**：
   > "这个模型架构在同类场景中验证过3次，这是某医美客户的基准测试报告..."

---
